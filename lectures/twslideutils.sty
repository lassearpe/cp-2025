\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{twslideutils}

\RequirePackage{hyperref}
\RequirePackage{xspace}
\RequirePackage{biblatex}
\RequirePackage{tikz}
\usetikzlibrary{arrows,shapes,calc}
\RequirePackage{xparse}

\newcommand{\backupbegin}{
   \newcounter{finalframe}
   \setcounter{finalframe}{\value{framenumber}}
   \renewcommand{\insertframenumber}{\texorpdfstring{\(\infty\)}{7}}
}
\newcommand{\backupend}{
   \setcounter{framenumber}{\value{finalframe}}
}
\newenvironment{preframe}{
\renewcommand{\insertframenumber}{\arabic{framenumber}.$\infty$}
   \addtocounter{framenumber}{-1}
}{
\renewcommand{\insertframenumber}{\arabic{framenumber}}
}



% some citation things

\renewcommand{\finalnamedelim}{, }

\DeclareFieldFormat{shortyear}{\mkbibshortyear#1}
\def\mkbibshortyear#1#2#3#4{#3#4}

\newrobustcmd*{\citeshortyear}{%
  \AtNextCite{\DeclareFieldAlias{year}{shortyear}}%
  \citeyear}

\newcommand{\mycite}[1]{\begin{flushright}\visible<1->{\color{gray}\citeauthor{#1}
'\citeshortyear{#1}}\end{flushright}}
\newcommand{\mycitehere}[1]{{\color{gray}\citeauthor{#1} '\citeshortyear{#1}}}


% tikz utils

\usetikzlibrary{arrows,shapes,calc}

\pgfdeclarelayer{background}
\pgfsetlayers{background,main}

\tikzstyle{descarrow}=[
    draw,solid,>=stealth',->,line cap=round cap,thick,
                  color=Gray!60,
                  shorten <=-1mm,
                  shorten >=1mm,
]
\tikzstyle{desctext}=[
    text=OliveGreen,
    font=\scriptsize,
]

\tikzset{
  invisible/.style={opacity=0},
  visible on/.style={alt={#1{}{invisible}}},
  alt/.code args={<#1>#2#3}{%
    \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % \pgfkeysalso doesn't change the path
  },
}

\tikzset{
  cloudnode/.style={
    draw=white,fill=black!10!white,anchor=south,
    text=black!80!white,
    align=center,
    solid,
    cloud, cloud puffs=10,cloud puff arc=120, aspect=2, inner sep= -0.0cm,
    font=\scriptsize,
  },
}
\def\tikzoverlay{%
   \tikz[baseline,overlay]\node[cloudnode]
}%

\DeclareDocumentCommand{\thought}{ O{above} m m}{%
\begin{tikzpicture}[baseline = (target.base),node distance=9mm,
                            ]
            \node[inner sep=0mm] (target) {#3};
            \useasboundingbox (target.north west) -- (target.base);
            \node[
                    cloudnode,
                    inner sep=0.0cm,
                    anchor = center,
                 ] (desc) [#1 of=target]
                {#2};
        \end{tikzpicture}}

\DeclareDocumentCommand{\desc}{ O{below} O{bend left} m m}{%
\begin{tikzpicture}[baseline = (target.base),node distance=1.3cm,
                            every path/.style={
                                bend angle=10,
                            }]
            \node[inner sep=0mm] (target) {\scriptsize{\ensuremath{#4}}};
            \useasboundingbox (target.north west) -- (target.base);
            \node[
                    desctext,
                 ] (desc) [#1 of=target]
                {#3};
            \path[descarrow,
                  #2] (desc) edge (target);
        \end{tikzpicture}}

\DeclareDocumentCommand{\ldesc}{ O{below} O{bend left} m m}{%
\begin{tikzpicture}[baseline = (target.base),node distance=1.3cm,
                            every path/.style={
                                bend angle=10,
                            }]
            \node[inner sep=0mm] (target) {{\ensuremath{#4}}};
            \useasboundingbox (target.north west) -- (target.base);
            \node[
                    desctext,
                 ] (desc) [#1 of=target]
                {#3};
            \path[descarrow,
                  #2] (desc) edge (target);
        \end{tikzpicture}}

\newenvironment{question}
    {\setbeamercolor{block body}{bg=Black!15!white,fg=OliveGreen!80!black}
        \begin{block}{}
        \begin{tikzpicture}[baseline=(B)]
            \node (QM) {\Huge\color{white} ?};
            \coordinate (B) at ($ (QM.south) + (0,0.5mm) $);
        \end{tikzpicture}
        \hfill
        \begin{minipage}[b]{.8\textwidth}
    }
    {\end{minipage}
     \hfill
        \begin{tikzpicture}[baseline=(B)]
            \node (QM) {\Huge\color{white} ?};
            \coordinate (B) at ($ (QM.south) + (0,0.5mm) $);
        \end{tikzpicture}
     \end{block}}

\endinput
