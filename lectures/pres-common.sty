\usepackage{amsmath}    % ams mathematical facilities
\@ifclassloaded{llncs}
{
  \let\proof\relax\let\endproof\relax
  \usepackage{amsthm}
  \usepackage{txfonts}
}
{
  \usepackage{amsthm}
}
\@ifclassloaded{acmart}
{}
{
  \usepackage{amssymb}    % Math symbol definitions
}
%\usepackage{pifont}
%\usepackage{amsfonts}
\usepackage{graphicx}   % Enhanced support for graphics
\@ifclassloaded{lipics-v2021}
{}
{
  \@ifclassloaded{llncs}
  {
    \usepackage{wrapfig}    % To wrap figures
%    \usepackage[backend=bibtex,style=ieee]{biblatex} % citations
    \usepackage[dvipsnames,svgnames]{xcolor}     % Color extensions
  }
  {
    \@ifclassloaded{acmart}
    {}
    {
      \usepackage{wrapfig}    % To wrap figures
      \usepackage[backend=bibtex,style=ieee]{biblatex} % citations
      \usepackage[dvipsnames,svgnames]{xcolor}     % Color extensions
    }
  }
} 
\usepackage{hyperref}   % Hyperlinks

\@ifpackageloaded{cleveref}
{}
{\usepackage[capitalize,noabbrev,nameinlink]{cleveref}} % Intelligent cross-referencing

%\usepackage[colorinlistoftodos]{todonotes} % Todo notes
\usepackage{listings}   % For code listings
%\usepackage{caption}    % For figure captions
\usepackage{framed}     % Box frames
%\usepackage{packages/mathpartir} % Typesetting for formulas
\usepackage[altpo]{backnaur}
\usepackage{semantic}   % Helpers for programming lang semantics
%\usepackage{amsfonts,amsthm,xspace} % Fonts from the AMS
%\usepackage[inline]{enumitem} % Enumerate with redefinable label
\usepackage{stmaryrd}  % Some nice fonts for CS
\usepackage{verbatim}   % Verbatim enhancements
%\usepackage{subfig}    % Subfloat support
\usepackage{etoolbox}   % For scripting
%\usepackage{mdwtools}     % For BNF
\usepackage{cancel}       % Text decorations
\usepackage{adjustbox}  % Some scaling
\usepackage{cutwin}     % More save spacing measures
\usepackage{academicons} % for orcid

\usepackage{ifxetex}
\ifxetex
\usepackage{fontspec}
\defaultfontfeatures{Path = ./fonts/}
\usepackage{fontawesome5} % For nice little symbols
\else
\usepackage{fontawesome5} % For nice little symbols
\fi

\usepackage[edges]{forest}
\usepackage{multirow}
\usepackage{mathtools}
\usepackage{enumerate}
\usepackage{refcount}
\setrefcountdefault{1}

\@ifclassloaded{lipics-v2021}
{}
{\usepackage[mathscr]{euscript}}

\usetikzlibrary{arrows,arrows.meta} % For fancier tikzcd arrows

%
% If you use the hyperref package, please uncomment the following line
% to display URLs in blue roman font according to Springer's eBook style:
%\renewcommand\UrlFont{\color{blue}\rmfamily}

\@ifclassloaded{acmart}
{}
{
  \newcommand{\orcid}[1]{\href{https://orcid.org/#1}{\textcolor[HTML]{A6CE39}{\aiOrcid}}}
}

\usepackage{tikz}
%\usepackage{tikz}[
%roundnode/.style={circle, draw=green!60, fill=green!5, very thick, minimum size=7mm},
%squarednode/.style={rectangle, draw=red!60, fill=red!5, very thick, minimum size=5mm},
%]       % fancy diagrams
\usepackage{tikz-cd}    % For commutative diagrams
\usepackage{tikz-qtree}

\usepackage{centernot} % Added for LICS

\@ifclassloaded{lipics-v2021}
{}
{
  \@ifclassloaded{llncs}
  {}
  {
%
% Theorem environments; needs to be loaded before hyperref so that
% \autoref works
%
\usepackage{thmtools}

\newcommand{\ownthmSpaceAbove}{5pt}
\newcommand{\ownthmSpaceBelow}{5pt}
% all thmtools hooks are within the theorem group, so we need to adjust global definitions
\newcommand{\resetCurThmBraces}{%
\gdef\curThmBraceOpen{(}%
\gdef\curThmBraceClose{)}}
\resetCurThmBraces
\newcommand{\removeThmBraces}{%
\gdef\curThmBraceOpen{}%
\gdef\curThmBraceClose{}}

\@ifclassloaded{beamer}
{}
{
\declaretheoremstyle[
    spaceabove=\ownthmSpaceAbove,
    spacebelow=\ownthmSpaceBelow,
    headpunct=.,
    postheadspace=.5em,
    notebraces={\curThmBraceOpen}{\curThmBraceClose},
    postheadhook={\resetCurThmBraces},
]{definition}
\declaretheoremstyle[
    style=definition,
    bodyfont=\itshape,
    notebraces={\curThmBraceOpen}{\curThmBraceClose},
    postheadhook={\resetCurThmBraces},
]{theorem}
%\makeatletter
%\declaretheoremstyle[
%    style=definition,
%    % another workaround, see http://tex.stackexchange.com/questions/91487/thmtools-issue-with-head-number-style
%    preheadhook=\renewcommand\@upn{},
%    headpunct=.,
%    headfont=\it,
%]{remark}
%\makeatother
    
    \theoremstyle{theorem}
    \newtheorem{theorem}{Theorem}[section]
    \newtheorem{proposition}[theorem]{Proposition}
    \newtheorem{corollary}[theorem]{Corollary}
    \newtheorem{lemma}[theorem]{Lemma}
    \theoremstyle{definition}
    \newtheorem{example}[theorem]{Example}
    \theoremstyle{definition}
    \newtheorem{definition}[theorem]{Definition}
    %\theoremstyle{remark}
    \newtheorem{remark}[theorem]{Remark}}
}}

\newtheorem{criterion}{Criterion}

%% Constants and parameters
\newcommand{\nat}{\Longrightarrow} % Natural transformation symbol
\newcommand{\pr}{^\prime}
\newcommand{\prpr}{^{\prime\prime}}

%\newcommand{\init}{\bot} % initial object
\newcommand{\init}{\varnothing} % initial object
\newcommand{\term}{1} % terminal object
%\newcommand{\term}{\top} % terminal object

\newcommand{\cf}{H} % Context functor
\newcommand{\product}{\times}
% \newcommand{\coproduct}{\uplus}
\newcommand{\coproduct}{+}

\newcommand{\cat}[1]{{\mathbb{#1}}}
\newcommand{\Set}{\mathbf{Set}}
\newcommand{\Rel}{\mathbf{Rel}}
\newcommand{\Cat}{\mathbf{Cat}}



\newcommand{\Id}{\mathrm{Id}}
\newcommand{\id}{\mathrm{id}}

\newcommand{\hole}{\bullet}
\newcommand{\con}{\text{\faSignIn}}

\newcommand{\sat}{\chi}

\newcommand{\Proj}{\pi}
\newcommand{\Inj}{i}
	%if you want \iota instead, you'll have to change some hardcoded i's.
\newcommand{\strength}{\mathsf{st}}

\newcommand{\plug}[1]{\left\llbracket #1 \right\rrbracket}

\newcommand{\ctxeq}{\sim_{\mathrm{ctx}}}
\newcommand{\bisim}{\sim_{\mathrm{bis}}}
\newcommand{\bisimspan}{(\bisim)}

\newcommand{\fin}[1]{#1\nrightarrow}
\newcommand{\finv}[2]{#1\nrightarrow#2}
\newcommand{\evfin}[1]{#1\Downarrow}
\newcommand{\evfinv}[2]{#1\Downarrow#2}
%\newcommand{\goes}[2]{#1 \rightarrow #2}

\newcommand{\kl}[1]{\mathcal{K}\ell(#1)}

\newcommand{\lift}[1]{{\overline{#1}}}
\newcommand{\internal}[1]{{\lbag #1 \rbag}}

\newif\ifedit

% Comment out to remove comments
\edittrue

\ifedit
\newcommand{\ST}[1]{\textcolor{purple}{ST: #1}}
\newcommand{\STin}[1]{\todo[color=purple!30,inline]{Stelios: #1}}
\newcommand{\AN}[1]{\textcolor{brown}{AN: #1}}
\newcommand{\ANin}[1]{\todo[color=yellow!30,inline]{Andreas: #1}}
\newcommand{\DD}[1]{\textcolor{brown}{DD: #1}}
\newcommand{\DDin}[1]{\todo[color=yellow!30,inline]{Dominique: #1}}
\newcommand{\HU}[1]{\textcolor{brown}{DD: #1}}
\newcommand{\HUin}[1]{\todo[color=yellow!30,inline]{Henning: #1}}
\newcommand{\SM}[1]{\textcolor{brown}{DD: #1}}
\newcommand{\SMin}[1]{\todo[color=yellow!30,inline]{Stefan: #1}}
\newcommand{\LS}[1]{\textcolor{brown}{DD: #1}}
\newcommand{\LSin}[1]{\todo[color=yellow!30,inline]{Lutz: #1}}
\else
\newcommand{\ST}[1]{}
\newcommand{\STin}[1]{}
\newcommand{\AN}[1]{}
\newcommand{\ANin}[1]{}
\newcommand{\DD}[1]{}
\newcommand{\DDin}[1]{}
\newcommand{\HU}[1]{}
\newcommand{\HUin}[1]{}
\newcommand{\SM}[1]{}
\newcommand{\SMin}[1]{}
\newcommand{\LS}[1]{}
\newcommand{\LSin}[1]{}
\fi

% Alternate \to for Kleisli category
\newcommand{\tokl}[2]{%
  \tikzcdset{arrow style=tikz, diagrams={>= Turned Square [open]}}
  \begin{tikzcd}[ampersand replacement=\&, column sep = small, nodes={inner sep=1pt}] #1 \arrow[r] \&
    #2 \end{tikzcd}\tikzcdset{arrow style=tikz, diagrams={>= To}}}

\newcommand{\toklkl}[2]{%
  \tikzcdset{arrow style=tikz, diagrams={>= Circle []}}
  \begin{tikzcd}[ampersand replacement=\&, column sep = small, nodes={inner sep=1pt}] #1 \arrow[r] \&
    #2 \end{tikzcd}\tikzcdset{arrow style=tikz, diagrams={>= To}}}

% Arrow commands

\newcommand{\bialg}[5]{%
  \begin{tikzcd}[column sep = small, nodes={inner sep=2pt}, ampersand replacement=\&] #1 \arrow[r, "#2"] \&
    #3 \arrow[r, "#4"] \& #5\end{tikzcd}}

\newcommand{\bialgkl}[5]{%
  \tikzcdset{arrow style=tikz, diagrams={>= Turned Square [open]}}
  \begin{tikzcd}[ampersand replacement=\&] #1 \arrow[r, "#2"] \&
    #3 \arrow[r, "#4"] \& #5\end{tikzcd}\tikzcdset{arrow style=tikz, diagrams={>= To}}}

\newcommand{\bialgklkl}[5]{%
\tikzcdset{arrow style=tikz, diagrams={>= Circle []}}
\begin{tikzcd}[column sep = scriptsize, nodes={inner sep=1pt}, ampersand replacement=\&] #1 \arrow[r, "#2"] \&
  #3 \arrow[r, "#4"] \& #5\end{tikzcd}\tikzcdset{arrow style=tikz, diagrams={>=
    To}}}

\newcommand{\luarrow}[4]{%
  \begin{tikzcd}[column sep = scriptsize, ampersand replacement=\&] #1 \arrow[r, "#3", "#4"'] \&
    #2 \end{tikzcd}}

\newcommand{\kluarrow}[4]{%
  \tikzcdset{arrow style=tikz, diagrams={>= Turned Square [open]}}
  \begin{tikzcd}[column sep = small, ampersand replacement=\&] #1 \arrow[r, "#3", "#4"'] \&
    #2 \end{tikzcd}\tikzcdset{arrow style=tikz, diagrams={>= To}}}

\newcommand{\klarrow}[3]{%
  \tikzcdset{arrow style=tikz, diagrams={>= Turned Square [open]}}
  \begin{tikzcd}[ampersand replacement=\&] #1 \arrow[r, "#3"] \&
    #2 \end{tikzcd}\tikzcdset{arrow style=tikz, diagrams={>= To}}}

\newcommand{\arrow}[2]{%
  $\begin{tikzcd}[ampersand replacement=\&] #1 \arrow[r, shift left=0.3ex] \& #2 \end{tikzcd}$}

\newcommand{\iarrow}[2]{%
  $\begin{tikzcd}[ampersand replacement=\&] #1 \arrow[r, tail, shift left=0.2ex] \& #2 \end{tikzcd}$}

\newcommand{\larrow}[3]{%
  $\begin{tikzcd}[ampersand replacement=\&] #1 \arrow[r, "#3"] \&
    #2 \end{tikzcd}$}

\newcommand{\liarrow}[3]{%
  $\begin{tikzcd}[ampersand replacement=\&] #1 \arrow[r, tail, "#3"] \&
    #2 \end{tikzcd}$}

\newcommand{\lsarrow}[3]{%
  $\begin{tikzcd}[ampersand replacement=\&] #1 \arrow[r, two heads, "#3"] \&
    #2 \end{tikzcd}$}

\newcommand{\libarrow}[5]{%
  $\begin{tikzcd}[ampersand replacement=\&] #1 \arrow[r, "#4"] \&
    #2 \arrow[r, "#5"] \& #3 \end{tikzcd}$}


\newcommand{\ngoesv}[2]{\ensuremath{#1 \centernot{\xrightarrow{~#2~}}}} % Addded for LICS

\newcommand{\Goes}[2]{\ensuremath{#1 \Rightarrow #2}}
\newcommand{\goes}[2]{\ensuremath{#1 \rightarrow #2}}
% \newcommand{\goes}[2]{\begin{tikzcd}[ampersand replacement=\&]#1 \arrow[r]
%   \& #2\end{tikzcd}}
\newcommand{\Rets}[2]{\ensuremath{#1 \Downarrow #2}}
\newcommand{\Retsc}[2]{\ensuremath{#1 \Rightarrow #2, \checkmark}}
 \newcommand{\rets}[2]{\ensuremath{#1 \downarrow #2}}
\newcommand{\retsc}[2]{\ensuremath{#1 \rightarrow #2, \checkmark}}
%\newcommand{\rets}[2]{\begin{tikzcd}[ampersand replacement=\&]#1
%   \arrow{r}[anchor=center]{/} \& #2\end{tikzcd}}

%\newcommand{\Goesv}[3]{\ensuremath{#1 \Longrightarrow_{#3} #2}}
\newcommand{\Goesv}[3]{\ensuremath{#1 \xRightarrow{~#3~} #2}}
\newcommand{\goesv}[3]{\ensuremath{#1 \xrightarrow{~#3~} #2}}
% \newcommand{\goesv}[3]{\begin{tikzcd}[ampersand replacement=\&]#1 \arrow[r, "#3"]
%     \& #2\end{tikzcd}}
%\newcommand{\retsv}[3]{\ensuremath{#1 \Downarrow_{#3} #2}}
\newcommand{\retsv}[3]{\ensuremath{#1 \xrightarrow{~#3~} #2, \checkmark}}
% \newcommand{\retsv}[3]{\begin{tikzcd}[ampersand replacement=\&]#1
%     \arrow{r}[anchor=center]{/}[anchor=south west]{#3} \& #2\end{tikzcd}}

\newcommand{\retsvr}[3]{\ensuremath{#1~\textcolor{red}{\Downarrow_{#3}}~#2}}
% \newcommand{\retsvr}[3]{\begin{tikzcd}[ampersand replacement=\&]#1
%     \arrow[color=red]{r}[anchor=center]{/}[anchor=south west]{#3} \& #2\end{tikzcd}}

\newcommand{\while}{\emph{While}}
\newcommand{\spc}{\emph{SPC}}
\newcommand{\flagsym}{{\text{\faBellO}}}
\newcommand{\secflagsym}{{\text{\faBellSlashO}}}
\newcommand{\trace}{\emph{Trace}}

\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%


\newcommand{\set}{\mathbf{Set}}
\newcommand{\cpo}{\omega\text{-}\mathbf{Cpo}}
\newcommand{\cppo}{\mathbf{Cppo}}
\newcommand{\cpov}{\omega\text{-}\mathbf{Cpo}_{ld}^{\vee}}

\newcommand{\symend}[0]{\hfill$\lrcorner$}

\newcommand{\vertleq}{\rotatebox{90}{$\leq$}} % Added for LICS

\newcommand{\src}[1]{#1_{1}}
\newcommand{\trg}[1]{#1_{2}}

\newcommand{\op}[1]{\mathop{#1}}

\newcommand{\Nat}{\mathsf{Nat}}

\newcommand{\inm}{\oname{in}}

\newcommand{\out}{\mathop{\oname{out}}}
\newcommand{\tuo}{\mathop{\oname{out}^\mone}}
\newcommand{\coit}{\mathop{\oname{coit}}}
\newcommand{\const}{\mathop{\oname{const}}}

\newcommand{\sm}{\mathop{\oname{sm}}}

%\hypersetup{pdfpagemode=UseOutlines, colorlinks=true, linkcolor=blue, citecolor=blue}

\makeatletter
\DeclareFontFamily{OMX}{MnSymbolE}{}
\DeclareSymbolFont{MnLargeSymbols}{OMX}{MnSymbolE}{m}{n}
\SetSymbolFont{MnLargeSymbols}{bold}{OMX}{MnSymbolE}{b}{n}
\DeclareFontShape{OMX}{MnSymbolE}{m}{n}{
  <-6>  MnSymbolE5
  <6-7>  MnSymbolE6
  <7-8>  MnSymbolE7
  <8-9>  MnSymbolE8
  <9-10> MnSymbolE9
  <10-12> MnSymbolE10
  <12->   MnSymbolE12
}{}
\DeclareFontShape{OMX}{MnSymbolE}{b}{n}{
  <-6>  MnSymbolE-Bold5
  <6-7>  MnSymbolE-Bold6
  <7-8>  MnSymbolE-Bold7
  <8-9>  MnSymbolE-Bold8
  <9-10> MnSymbolE-Bold9
  <10-12> MnSymbolE-Bold10
  <12->   MnSymbolE-Bold12
}{}

\let\llangle\@undefined
\let\rrangle\@undefined
\DeclareMathDelimiter{\llangle}{\mathopen}%
{MnLargeSymbols}{'164}{MnLargeSymbols}{'164}
\DeclareMathDelimiter{\rrangle}{\mathclose}%
{MnLargeSymbols}{'171}{MnLargeSymbols}{'171}
\makeatother
